// TERSER - MINIFY JS
const terser = require('terser-webpack-plugin');

module.exports = () => {
   const options = {
      // prevents TerserPlugin from extracting a [chunkName].js.LICENSE.txt file
      extractComments: false,

      // Use multi-process parallel running to improve the build speed.
      // Default number of concurrent runs: os.cpus().length - 1.
      // Default: true
      // parallel: true,

      terserOptions: {
         // The output generated by `babel/preset-modules` includes workarounds for
         // Safari 10, however minifiers like Terser sometimes remove these workarounds.
         // In order to avoid shipping broken code, it's important to tell Terser to
         // preserve the workarounds, which can be done via the safari10 option.
         // (default: false):
         safari10: true,

         format: {
            // Tell terser to remove all comments except for the banner.
            // See the terser documentation for format.comments options for more details.
            comments: (astNode, comment) =>
               comment.value.startsWith('! Please find licenses at '),
            // comments: false, // If you avoid building with comments, use this config
         },
      },
   };

   return new terser(options);
};
